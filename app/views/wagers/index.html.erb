<div class="mx-auto max-w-6xl px-6 py-10">
  <div
    data-privy-widget="1"
    data-variant="logout_only"
    data-privy-app-id="<%= ENV["PRIVY_APP_ID"].to_s %>"
  ></div>

  <div class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-12">
    <div class="lg:col-span-7 lg:col-start-2">
      <div class="rounded-xl border border-slate-200 bg-white shadow-sm">
        <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-5 py-4">
          <h1 class="text-2xl font-semibold text-slate-900">Wagers</h1>
          <%= link_to "New wager", new_wager_path, class: "inline-flex cursor-pointer items-center rounded-lg bg-black px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 active:bg-slate-950" %>
        </div>

        <div class="divide-y">
          <% @wagers.each do |w| %>
            <div class="px-5 py-4">
              <div class="flex items-center justify-between gap-4">
                <div class="min-w-0">
                  <%= link_to wager_path(w), class: "block" do %>
                    <div class="font-mono text-sm text-slate-700">
                      <%= w.tag_a %> vs <%= w.tag_b.presence || "?" %>
                    </div>
                    <div class="mt-1 text-xs text-slate-500">created <%= time_ago_in_words(w.created_at) %> ago</div>
                  <% end %>
                </div>

                <div class="shrink-0 text-right">
                  <div class="text-sm font-medium text-slate-900"><%= w.status %></div>
                  <div class="text-xs text-slate-500"><%= w.amount_lamports %> lamports</div>
                </div>
              </div>

              <% can_accept = w.joiner_id.nil? && w.creator_id != current_user.id && !w.status_expired? && !w.status_refunded? && !w.status_settled? && !w.status_failed? && w.deadline_at > Time.current %>
              <% if can_accept %>
                <div class="mt-3">
                  <%= button_to "Accept",
                    accept_wager_path(w),
                    method: :post,
                    class: "inline-flex cursor-pointer items-center rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm transition-colors hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 active:bg-slate-100" %>
                </div>
              <% end %>
            </div>
          <% end %>

          <% if @wagers.empty? %>
            <div class="px-5 py-4 text-slate-600">No wagers yet.</div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="lg:col-span-4 lg:col-start-9">
      <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
        <div class="text-xs font-semibold uppercase tracking-widest text-slate-500">Wallet</div>
        <div class="mt-4">
          <div
            data-privy-widget="1"
            data-variant="fund_only"
            data-privy-app-id="<%= ENV["PRIVY_APP_ID"].to_s %>"
            data-solana-cluster="<%= ENV.fetch("SOLANA_CLUSTER", "devnet") %>"
            data-solana-rpc-url="<%= ENV.fetch("SOLANA_RPC_URL", "https://api.devnet.solana.com") %>"
          ></div>
        </div>
      </div>
    </div>
  </div>
</div>


